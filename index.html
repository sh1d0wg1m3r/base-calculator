<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base Calculator (Binary/Octal/Hex)</title>
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary: #3b82f6;
            --bg: #0f172a;
            --panel-bg: #1e293b;
            --text: #e2e8f0;
            --accent: #d946ef;
            --success: #22c55e;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
        }

        /* Mode Switcher */
        .mode-switch {
            display: flex;
            background: rgba(0,0,0,0.3);
            padding: 5px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .mode-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            color: #64748b;
            border: none;
            cursor: pointer;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .mode-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Main Panel */
        .panel {
            background: var(--panel-bg);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border: 1px solid #334155;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #94a3b8;
        }

        input, select {
            width: 100%;
            padding: 15px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-family: 'Courier New', monospace;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Buttons */
        .btn-group {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        button.op-btn {
            padding: 15px;
            font-size: 1.5rem;
            background: #334155;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }
        button.op-btn:hover { background: var(--primary); }
        
        button.convert-btn {
            width: 100%;
            padding: 15px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
        }
        button.convert-btn:hover { opacity: 0.9; }

        /* Results */
        .result-area {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            border-left: 5px solid var(--success);
        }
        
        .steps {
            margin-top: 15px;
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            color: #cbd5e1;
            font-size: 0.95rem;
            border: 1px dashed #475569;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="mode-switch">
        <button class="mode-btn active" id="tabArith" onclick="switchMode('arithmetic')">Arithmetic Operations</button>
        <button class="mode-btn" id="tabConv" onclick="switchMode('conversion')">Base Conversion</button>
    </div>

    <div class="panel">
        
        <div id="ui-arithmetic">
            <div style="margin-bottom: 20px;">
                <label>Base</label>
                <select id="arithBase">
                    <option value="2">Binary (Base 2)</option>
                    <option value="8">Octal (Base 8)</option>
                    <option value="16">Hexadecimal (Base 16)</option>
                </select>
            </div>

            <div class="grid-2">
                <div>
                    <label>Number A</label>
                    <input type="text" id="numA" placeholder="...">
                </div>
                <div>
                    <label>Number B</label>
                    <input type="text" id="numB" placeholder="...">
                </div>
            </div>

            <div class="btn-group">
                <button class="op-btn" onclick="calc('+')">+</button>
                <button class="op-btn" onclick="calc('-')">−</button>
                <button class="op-btn" onclick="calc('*')">×</button>
                <button class="op-btn" onclick="calc('/')">÷</button>
            </div>
        </div>

        <div id="ui-conversion" class="hidden">
            <div class="grid-2">
                <div>
                    <label>From Base</label>
                    <select id="convFrom">
                        <option value="2">Binary</option>
                        <option value="8">Octal</option>
                        <option value="10">Decimal</option>
                        <option value="16">Hexadecimal</option>
                    </select>
                </div>
                <div>
                    <label>To Base</label>
                    <select id="convTo">
                        <option value="2">Binary</option>
                        <option value="8">Octal</option>
                        <option value="10">Decimal</option>
                        <option value="16">Hexadecimal</option>
                    </select>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label>Number</label>
                <input type="text" id="convNum" placeholder="Enter value...">
            </div>

            <button class="convert-btn" onclick="convert()">Convert</button>
        </div>

        <div id="output" class="result-area hidden">
            <div id="resMain" style="font-size: 1.5rem; font-weight: bold; margin-bottom: 10px;"></div>
            <div id="resSteps" class="steps"></div>
        </div>

    </div>
</div>

<script>
    // --- UTILS ---
    function switchMode(mode) {
        const arith = document.getElementById('ui-arithmetic');
        const conv = document.getElementById('ui-conversion');
        const tabA = document.getElementById('tabArith');
        const tabC = document.getElementById('tabConv');
        const out = document.getElementById('output');

        out.classList.add('hidden');

        if(mode === 'arithmetic') {
            arith.classList.remove('hidden');
            conv.classList.add('hidden');
            tabA.classList.add('active');
            tabC.classList.remove('active');
        } else {
            arith.classList.add('hidden');
            conv.classList.remove('hidden');
            tabA.classList.remove('active');
            tabC.classList.add('active');
        }
    }

    // Helper for char conversions
    const getVal = c => parseInt(c, 16);
    const getChar = v => v.toString(16).toUpperCase();

    // --- ARITHMETIC LOGIC ---

    function calc(op) {
        const base = parseInt(document.getElementById('arithBase').value);
        const sA = document.getElementById('numA').value.trim().toUpperCase();
        const sB = document.getElementById('numB').value.trim().toUpperCase();

        if(!sA || !sB) return;

        // Validation
        if(isNaN(parseInt(sA, base)) || isNaN(parseInt(sB, base))) {
            showError(`Invalid inputs for Base ${base}`);
            return;
        }

        let result = {};

        // Route to specific handlers
        if (base === 2) {
            // Binary Specific Native Logic
            if(op === '*') result = binaryMult(sA, sB);
            else if(op === '/') result = binaryDiv(sA, sB);
            else if(op === '+') result = nativeAdd(sA, sB, 2);
            else if(op === '-') result = nativeSub(sA, sB, 2);
        } else {
            // Octal/Hex Logic
            if(op === '+') result = nativeAdd(sA, sB, base);
            else if(op === '-') result = nativeSub(sA, sB, base);
            else result = bridgeMath(sA, sB, base, op); // Fallback for hard mult/div
        }

        renderResult(result, base);
    }

    // NATIVE BINARY MULTIPLICATION (Shift & Add)
    function binaryMult(A, B) {
        let steps = [`<strong>Binary Multiplication (Shift & Add):</strong>`];
        steps.push(`   ${A}`);
        steps.push(`x  ${B}`);
        steps.push(`-------`);

        let partials = [];
        let bRev = B.split('').reverse();
        
        // Generate partial products
        for(let i=0; i < bRev.length; i++) {
            let digit = bRev[i];
            let shift = "0".repeat(i);
            
            if(digit === '1') {
                let part = A + shift;
                partials.push(parseInt(part, 2)); // store val for summing
                steps.push(`   ${A} (x1, shift ${i}) -> ${part.padStart(A.length + B.length, ' ')}`);
            } else {
                let part = "0" + shift; // simplistic representation
                steps.push(`   000... (x0, shift ${i})`);
            }
        }
        
        steps.push(`-------`);
        // Calculate sum
        let sum = parseInt(A, 2) * parseInt(B, 2);
        let binSum = sum.toString(2);
        steps.push(`Sum all partials: ${binSum}`);

        return { val: binSum, steps: steps.join('\n') };
    }

    // NATIVE BINARY DIVISION (Long Division)
    function binaryDiv(dividendStr, divisorStr) {
        let divisor = parseInt(divisorStr, 2);
        let dividendVal = parseInt(dividendStr, 2);

        if(divisor === 0) return { val: "Undefined", steps: "Division by Zero" };

        let steps = [`<strong>Binary Long Division:</strong>`];
        steps.push(`   __________`);
        steps.push(`${divisorStr} ) ${dividendStr}`);
        
        let result = "";
        let currentPartStr = "";
        let stepsLog = [];

        // Iterate through dividend bits
        for (let i = 0; i < dividendStr.length; i++) {
            currentPartStr += dividendStr[i];
            let currentPartVal = parseInt(currentPartStr, 2);

            stepsLog.push(`\nBit ${i}: Bring down ${dividendStr[i]}. Working num: ${currentPartStr}`);

            if (currentPartVal >= divisor) {
                stepsLog.push(`   ${divisorStr} fits in ${parseInt(currentPartVal.toString(2), 2).toString(2)}? YES (1)`);
                result += "1";
                let rem = currentPartVal - divisor;
                stepsLog.push(`   Subtract: ${currentPartVal.toString(2)} - ${divisorStr} = ${rem.toString(2)}`);
                currentPartStr = rem.toString(2);
            } else {
                stepsLog.push(`   ${divisorStr} fits in ${parseInt(currentPartVal.toString(2), 2).toString(2)}? NO (0)`);
                result += "0";
            }
        }
        
        // Clean up result
        result = result.replace(/^0+/, '') || '0';
        steps.push(stepsLog.join(''));
        steps.push(`\n<strong>Quotient:</strong> ${result}`);
        steps.push(`<strong>Remainder:</strong> ${currentPartStr}`);

        return { val: `${result} (R: ${currentPartStr})`, steps: steps.join('\n') };
    }

    // NATIVE ADDITION (Generic)
    function nativeAdd(aStr, bStr, base) {
        let steps = [`<strong>Column Addition (Base ${base}):</strong>`];
        let maxLen = Math.max(aStr.length, bStr.length);
        let A = aStr.padStart(maxLen, '0').split('').reverse();
        let B = bStr.padStart(maxLen, '0').split('').reverse();
        let res = "", carry = 0;

        for(let i=0; i<maxLen; i++) {
            let va = getVal(A[i]), vb = getVal(B[i]);
            let sum = va + vb + carry;
            let write = sum % base;
            let newCarry = Math.floor(sum / base);

            steps.push(`Col ${i}: ${getChar(va)}+${getChar(vb)}+${carry} = ${sum}. Write ${getChar(write)}, Carry ${newCarry}`);
            res = getChar(write) + res;
            carry = newCarry;
        }
        if(carry) {
            steps.push(`Final Carry: ${getChar(carry)}`);
            res = getChar(carry) + res;
        }
        return { val: res, steps: steps.join('\n') };
    }

    // NATIVE SUBTRACTION (Generic)
    function nativeSub(aStr, bStr, base) {
        let vA = parseInt(aStr, base);
        let vB = parseInt(bStr, base);
        if(vA < vB) return { val: "Negatives not supported", steps: "A must be >= B" };

        let steps = [`<strong>Column Subtraction (Base ${base}):</strong>`];
        let A = aStr.split('').reverse().map(getVal);
        let B = bStr.padStart(aStr.length, '0').split('').reverse().map(getVal);
        let res = "";

        for(let i=0; i<A.length; i++) {
            let va = A[i], vb = B[i] || 0;
            if(va < vb) {
                // Borrow Logic
                let j = i + 1;
                while(j < A.length && A[j] === 0) j++;
                if(j < A.length) {
                    A[j]--;
                    for(let k=j-1; k>i; k--) A[k] = base-1;
                    va += base;
                    steps.push(`Col ${i}: Borrowed. ${va} - ${vb} = ${va-vb}`);
                }
            } else {
                steps.push(`Col ${i}: ${va} - ${vb} = ${va-vb}`);
            }
            res = getChar(va - vb) + res;
        }
        return { val: res.replace(/^0+/, '') || '0', steps: steps.join('\n') };
    }

    // BRIDGE MATH (For Oct/Hex Mul/Div)
    function bridgeMath(a, b, base, op) {
        let da = parseInt(a, base), db = parseInt(b, base);
        let resDec = op=='*' ? da*db : Math.floor(da/db);
        if(op=='/' && db==0) return {val:"Undefined", steps:"Div by 0"};
        
        let s = `<strong>Operation via Decimal:</strong>\n`;
        s += `1. ${a} -> ${da} (dec)\n2. ${b} -> ${db} (dec)\n`;
        s += `3. ${da} ${op} ${db} = ${resDec}\n`;
        s += `4. Convert ${resDec} to Base ${base}`;
        return { val: resDec.toString(base).toUpperCase(), steps: s };
    }

    // --- CONVERSION LOGIC ---

    function convert() {
        const from = parseInt(document.getElementById('convFrom').value);
        const to = parseInt(document.getElementById('convTo').value);
        const num = document.getElementById('convNum').value.trim().toUpperCase();

        if(!num) return;
        
        try {
            // Validation
            const digits = num.split('');
            for(let d of digits) if(getVal(d) >= from) throw "Invalid Digit";
            
            const dec = parseInt(num, from);
            const res = dec.toString(to).toUpperCase();
            
            let s = `<strong>Conversion Path: Base ${from} -> Decimal -> Base ${to}</strong>\n\n`;
            
            // To Decimal
            s += `<strong>1. To Decimal:</strong>\n`;
            let sumStr = [];
            num.split('').reverse().forEach((d,i) => {
                s += `   ${d} × ${from}^${i} = ${getVal(d) * Math.pow(from,i)}\n`;
            });
            s += `   Sum = ${dec}\n\n`;

            // From Decimal
            s += `<strong>2. To Base ${to}:</strong>\n`;
            let curr = dec;
            if(curr===0) s += "   0 -> 0";
            while(curr > 0) {
                let rem = curr % to;
                let quot = Math.floor(curr/to);
                s += `   ${curr} ÷ ${to} = ${quot} R ${getChar(rem)}\n`;
                curr = quot;
            }
            s += `   Result (Bottom-up): ${res}`;

            renderResult({val: res, steps: s}, to);

        } catch(e) {
            showError("Invalid Number");
        }
    }

    function renderResult(data, base) {
        const out = document.getElementById('output');
        const main = document.getElementById('resMain');
        const steps = document.getElementById('resSteps');

        main.innerHTML = `${data.val} <span style="font-size:0.6em; color:#94a3b8;">(Base ${base})</span>`;
        steps.innerHTML = data.steps;
        out.classList.remove('hidden');
    }

    function showError(msg) {
        const out = document.getElementById('output');
        out.innerHTML = `<span style="color: #ef4444;">${msg}</span>`;
        out.classList.remove('hidden');
    }

</script>
</body>
</html>
